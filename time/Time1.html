<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>时间间隔计算器 - 距离除夕倒计时</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- Lunar.js 农历转换库 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/lunar-javascript/1.6.13/lunar.js"></script>
  <!-- 统一的 Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e3a8a',
            secondary: '#3b82f6',
            accent: '#f97316',
            dark: '#0f172a',
            light: '#f8fafc'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'countdown': 'countdown 1s ease-in-out infinite',
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.5s ease-in-out',
          },
          keyframes: {
            countdown: {
              '0%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(1.05)' },
              '100%': { transform: 'scale(1)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
          },
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .text-shadow-lg {
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      .bg-gradient-primary {
        background: linear-gradient(135deg, theme('colors.primary'), theme('colors.secondary'));
      }
      .bg-glass {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
      .countdown-number {
        @apply text-4xl md:text-6xl font-bold text-primary;
      }
      .countdown-label {
        @apply text-sm md:text-base text-gray-600 mt-1;
      }
      .countdown-item {
        @apply flex flex-col items-center justify-center p-4 rounded-lg bg-white shadow-lg transition-all duration-300 hover:shadow-xl;
      }
      .btn-primary {
        @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
      }
      .btn-secondary {
        @apply bg-white hover:bg-gray-100 text-primary font-medium py-2 px-4 rounded-lg border border-gray-200 transition-all duration-300 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
      }
      .input-field {
        @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:border-transparent;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- 头部区域 -->
    <header class="text-center mb-12 animate-fade-in">
      <h1 class="text-4xl md:text-5xl font-bold text-primary mb-2 text-shadow">时间间隔计算器</h1>
      <p class="text-xl text-gray-600">计算距离目标时间的精确间隔</p>
    </header>

    <!-- 当前时间和农历显示 -->
    <div class="bg-gradient-primary text-white rounded-xl p-6 mb-8 shadow-lg animate-slide-up">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <p class="text-lg opacity-80">当前时间</p>
          <p id="current-time" class="text-3xl font-bold">2025-10-26 12:34:56</p>
        </div>
        <div class="flex items-center space-x-2">
          <i class="fa fa-calendar text-2xl"></i>
          <div>
            <p class="text-lg opacity-80">农历</p>
            <p id="lunar-date" class="text-2xl font-semibold">乙巳年九月十四</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 倒计时显示区域 -->
    <div class="bg-white rounded-xl p-8 mb-8 shadow-lg animate-slide-up" style="animation-delay: 0.1s;">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-bold text-primary mb-2">距离目标时间</h2>
        <p id="target-time-display" class="text-lg text-gray-600">2026年除夕 20:00:00</p>
      </div>
      
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-6">
        <div class="countdown-item">
          <span id="years" class="countdown-number">0</span>
          <span class="countdown-label">年</span>
        </div>
        <div class="countdown-item">
          <span id="months" class="countdown-number">0</span>
          <span class="countdown-label">月</span>
        </div>
        <div class="countdown-item">
          <span id="days" class="countdown-number">0</span>
          <span class="countdown-label">日</span>
        </div>
        <div class="countdown-item">
          <span id="hours" class="countdown-number">0</span>
          <span class="countdown-label">时</span>
        </div>
        <div class="countdown-item">
          <span id="minutes" class="countdown-number">0</span>
          <span class="countdown-label">分</span>
        </div>
        <div class="countdown-item">
          <span id="seconds" class="countdown-number">0</span>
          <span class="countdown-label">秒</span>
        </div>
      </div>
    </div>

    <!-- 控制面板 -->
    <div class="bg-white rounded-xl p-8 shadow-lg animate-slide-up" style="animation-delay: 0.2s;">
      <h2 class="text-2xl font-bold text-primary mb-6 text-center">控制面板</h2>
      
      <div class="flex flex-col md:flex-row justify-center items-center gap-6">
        <!-- 目标时间选择 -->
        <div class="w-full md:w-auto">
          <label for="target-date" class="block text-sm font-medium text-gray-700 mb-1">选择目标日期</label>
          <input type="date" id="target-date" class="input-field">
        </div>
        
        <div class="w-full md:w-auto">
          <label for="target-time" class="block text-sm font-medium text-gray-700 mb-1">选择目标时间</label>
          <input type="time" id="target-time" class="input-field">
        </div>
        
        <div class="flex flex-col gap-3 w-full md:w-auto">
          <button id="set-target-btn" class="btn-primary flex items-center justify-center">
            <i class="fa fa-check mr-2"></i> 设置目标时间
          </button>
          <button id="reset-to-new-year-btn" class="btn-secondary flex items-center justify-center">
            <i class="fa fa-refresh mr-2"></i> 重置为除夕
          </button>
        </div>
      </div>
    </div>

    <!-- 页脚 -->
    <footer class="mt-12 text-center text-gray-500 text-sm">
      <p>© 2025 时间间隔计算器 | 托管于 <a href="https://icepig.top/time" target="_blank" class="text-primary hover:underline">icepig.top/time</a></p>
    </footer>
  </div>

  <script>
    // 全局变量
    let targetDate = null;
    let countdownInterval = null;

    // DOM 元素
    const currentTimeEl = document.getElementById('current-time');
    const lunarDateEl = document.getElementById('lunar-date');
    const targetTimeDisplayEl = document.getElementById('target-time-display');
    const yearsEl = document.getElementById('years');
    const monthsEl = document.getElementById('months');
    const daysEl = document.getElementById('days');
    const hoursEl = document.getElementById('hours');
    const minutesEl = document.getElementById('minutes');
    const secondsEl = document.getElementById('seconds');
    const targetDateInput = document.getElementById('target-date');
    const targetTimeInput = document.getElementById('target-time');
    const setTargetBtn = document.getElementById('set-target-btn');
    const resetToNewYearBtn = document.getElementById('reset-to-new-year-btn');

    // 初始化函数
    function init() {
      // 设置默认目标时间为下一个除夕
      setDefaultTargetDate();
      
      // 更新当前时间和农历
      updateCurrentTime();
      
      // 开始倒计时
      startCountdown();
      
      // 添加事件监听器
      setTargetBtn.addEventListener('click', handleSetTargetTime);
      resetToNewYearBtn.addEventListener('click', handleResetToNewYear);
      
      // 每秒更新一次当前时间和倒计时
      setInterval(() => {
        updateCurrentTime();
        updateCountdown();
      }, 1000);
    }

    // 设置默认目标时间为下一个除夕
    function setDefaultTargetDate() {
      const now = new Date();
      let year = now.getFullYear();
      
      // 获取今年的除夕
      let newYearEve = getNewYearEve(year);
      
      // 如果今年的除夕已经过了，就取下一年的
      if (newYearEve < now) {
        newYearEve = getNewYearEve(year + 1);
      }
      
      // 设置目标时间为除夕晚上8点
      newYearEve.setHours(20, 0, 0, 0);
      
      targetDate = newYearEve;
      
      // 更新目标时间显示
      updateTargetTimeDisplay();
      
      // 更新日期和时间输入框
      updateDateAndTimeInputs();
    }

    // 获取指定年份的除夕日期
    function getNewYearEve(year) {
      // 使用lunar.js库获取农历信息
      // 除夕是农历十二月的最后一天
      // 我们可以通过获取农历正月初一（春节）的前一天来得到除夕
      
      try {
        // 获取农历正月初一（春节）
        const solar = Solar.fromYmd(year, 1, 1);
        const lunar = solar.getLunar();
        const nextLunarYear = lunar.getYear() + 1;
        
        // 找到农历新年（正月初一）
        let lunarNewYear = null;
        let month = 1;
        let day = 1;
        
        // 春节通常在公历1月下旬到2月中旬之间
        while (month <= 2) {
          const date = Solar.fromYmd(year, month, day);
          const lunarDate = date.getLunar();
          
          if (lunarDate.getYear() === nextLunarYear && lunarDate.getMonth() === 1 && lunarDate.getDay() === 1) {
            lunarNewYear = date.getDate();
            break;
          }
          
          day++;
          if (day > 29) { // 1月最多31天，2月最多29天
            day = 1;
            month++;
          }
        }
        
        // 如果找到了春节，除夕就是春节的前一天
        if (lunarNewYear) {
          const newYearEve = new Date(lunarNewYear);
          newYearEve.setDate(newYearEve.getDate() - 1);
          return newYearEve;
        }
      } catch (e) {
        console.error('计算除夕日期出错:', e);
      }
      
      // 如果无法通过农历计算，使用默认日期（1月21日）
      console.warn('无法计算除夕日期，使用默认日期');
      return new Date(year, 0, 21);
    }

    // 更新当前时间和农历
    function updateCurrentTime() {
      const now = new Date();
      
      // 更新当前时间
      currentTimeEl.textContent = formatDateTime(now);
      
      // 更新农历日期 - 修复农历显示
      const solar = Solar.fromDate(now);
      const lunar = solar.getLunar();
      const lunarMonth = lunar.getMonthInChinese().replace(/\s+/g, '');
      const lunarDay = lunar.getDayInChinese().replace(/\s+/g, '');
      lunarDateEl.textContent = `${lunar.getYearInGanZhi()}年${lunarMonth}月${lunarDay}`;
    }

    // 格式化日期时间
    function formatDateTime(date) {
      const year = date.getFullYear();
      const month = padZero(date.getMonth() + 1);
      const day = padZero(date.getDate());
      const hours = padZero(date.getHours());
      const minutes = padZero(date.getMinutes());
      const seconds = padZero(date.getSeconds());
      
      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }

    // 数字补零
    function padZero(num) {
      return num < 10 ? `0${num}` : num;
    }

    // 更新目标时间显示
    function updateTargetTimeDisplay() {
      if (!targetDate) return;
      
      // 检查是否是除夕
      const solar = Solar.fromDate(targetDate);
      const lunar = solar.getLunar();
      let displayText = '';
      
      if (lunar.getMonth() === 12 && (lunar.getDay() === 29 || lunar.getDay() === 30)) {
        displayText = `${targetDate.getFullYear()}年除夕 ${formatTime(targetDate)}`;
      } else {
        displayText = `${formatDate(targetDate)} ${formatTime(targetDate)}`;
      }
      
      targetTimeDisplayEl.textContent = displayText;
    }

    // 格式化日期
    function formatDate(date) {
      const year = date.getFullYear();
      const month = padZero(date.getMonth() + 1);
      const day = padZero(date.getDate());
      
      return `${year}-${month}-${day}`;
    }

    // 格式化时间
    function formatTime(date) {
      const hours = padZero(date.getHours());
      const minutes = padZero(date.getMinutes());
      const seconds = padZero(date.getSeconds());
      
      return `${hours}:${minutes}:${seconds}`;
    }

    // 更新日期和时间输入框
    function updateDateAndTimeInputs() {
      if (!targetDate) return;
      
      targetDateInput.value = formatDate(targetDate);
      targetTimeInput.value = formatTime(targetDate).substring(0, 5); // 不包含秒
    }

    // 开始倒计时
    function startCountdown() {
      // 清除之前的倒计时
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }
      
      // 更新倒计时
      updateCountdown();
      
      // 每秒更新一次倒计时
      countdownInterval = setInterval(() => {
        updateCountdown();
      }, 1000);
    }

    // 更新倒计时
    function updateCountdown() {
      if (!targetDate) return;
      
      const now = new Date();
      const diff = targetDate - now;
      
      // 如果目标时间已过，显示0
      if (diff <= 0) {
        updateCountdownDisplay(0, 0, 0, 0, 0, 0);
        return;
      }
      
      // 计算年、月、日、时、分、秒
      const { years, months, days, hours, minutes, seconds } = calculateTimeDifference(now, targetDate);
      
      // 更新显示
      updateCountdownDisplay(years, months, days, hours, minutes, seconds);
    }

    // 计算时间差
    function calculateTimeDifference(startDate, endDate) {
      // 计算总毫秒数差
      const diffMs = endDate - startDate;
      
      // 计算总秒数
      const totalSeconds = Math.floor(diffMs / 1000);
      
      // 计算秒
      const seconds = totalSeconds % 60;
      
      // 计算总分钟数
      const totalMinutes = Math.floor(totalSeconds / 60);
      
      // 计算分钟
      const minutes = totalMinutes % 60;
      
      // 计算总小时数
      const totalHours = Math.floor(totalMinutes / 60);
      
      // 计算小时
      const hours = totalHours % 24;
      
      // 计算总天数
      const totalDays = Math.floor(totalHours / 24);
      
      // 计算年、月、日
      let years = 0;
      let months = 0;
      let days = totalDays;
      
      // 简化计算，实际情况更复杂
      // 这里我们使用近似值：1年=365天，1月=30天
      years = Math.floor(days / 365);
      days %= 365;
      
      months = Math.floor(days / 30);
      days %= 30;
      
      return { years, months, days, hours, minutes, seconds };
    }

    // 更新倒计时显示
    function updateCountdownDisplay(years, months, days, hours, minutes, seconds) {
      yearsEl.textContent = years;
      monthsEl.textContent = months;
      daysEl.textContent = days;
      hoursEl.textContent = hours;
      minutesEl.textContent = minutes;
      secondsEl.textContent = seconds;
      
      // 添加动画效果
      [yearsEl, monthsEl, daysEl, hoursEl, minutesEl, secondsEl].forEach(el => {
        el.classList.add('animate-countdown');
        setTimeout(() => {
          el.classList.remove('animate-countdown');
        }, 500);
      });
    }

    // 处理设置目标时间按钮点击
    function handleSetTargetTime() {
      const dateStr = targetDateInput.value;
      const timeStr = targetTimeInput.value || '00:00';
      
      if (!dateStr) {
        alert('请选择目标日期');
        return;
      }
      
      // 解析日期和时间
      const [year, month, day] = dateStr.split('-').map(Number);
      const [hours, minutes] = timeStr.split(':').map(Number);
      
      const newTargetDate = new Date(year, month - 1, day, hours, minutes, 0, 0);
      
      // 检查日期是否有效
      if (isNaN(newTargetDate.getTime())) {
        alert('无效的日期或时间');
        return;
      }
      
      // 设置新的目标时间
      targetDate = newTargetDate;
      
      // 更新目标时间显示
      updateTargetTimeDisplay();
      
      // 重启倒计时
      startCountdown();
    }

    // 处理重置为除夕按钮点击
    function handleResetToNewYear() {
      // 设置目标时间为下一个除夕
      setDefaultTargetDate();
      
      // 重启倒计时
      startCountdown();
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
